<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Form Filler</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <!-- Auth Section (shown when not logged in) -->
  <div id="authSection" class="auth-section hidden">
    <div class="auth-container">
      <div class="auth-logo">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="3" stroke="url(#gradient2)" stroke-width="2"/>
          <path d="M7 9h10M7 12h7M7 15h10" stroke="url(#gradient2)" stroke-width="2" stroke-linecap="round"/>
          <defs>
            <linearGradient id="gradient2" x1="3" y1="3" x2="21" y2="21" gradientUnits="userSpaceOnUse">
              <stop stop-color="#7C3AED"/>
              <stop offset="1" stop-color="#EC4899"/>
            </linearGradient>
          </defs>
        </svg>
        <h2>Smart Form Filler</h2>
      </div>
      <div class="auth-form">
        <h3 id="authTitle">Login</h3>
        <div class="form-group">
          <input type="email" id="authEmail" placeholder="Email address">
        </div>
        <div class="form-group">
          <input type="password" id="authPassword" placeholder="Password">
        </div>
        <button id="authSubmit" class="btn btn-primary">Login</button>
        <button id="guestModeBtn" class="btn btn-secondary">Continue as Guest</button>
        <p class="auth-toggle">
          <span id="authToggleText">Don't have an account?</span>
          <a href="#" id="authToggleLink">Sign up</a>
        </p>
        <p id="authError" class="auth-error"></p>
      </div>
    </div>
  </div>

  <!-- Main App (shown when logged in) -->
  <div id="mainApp" class="container">
    <header>
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="3" stroke="url(#gradient)" stroke-width="2"/>
          <path d="M7 9h10M7 12h7M7 15h10" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round"/>
          <defs>
            <linearGradient id="gradient" x1="3" y1="3" x2="21" y2="21" gradientUnits="userSpaceOnUse">
              <stop stop-color="#7C3AED"/>
              <stop offset="1" stop-color="#EC4899"/>
            </linearGradient>
          </defs>
        </svg>
        <h1>Smart Form Filler</h1>
      </div>
      <div class="header-right">
        <div class="user-info" id="userInfo">
          <span class="user-email" id="userEmail"></span>
          <button id="syncBtn" class="sync-btn" title="Sync with cloud">â˜ï¸</button>
          <button id="logoutBtn" class="logout-btn" title="Logout">ğŸšª</button>
        </div>
        <div class="toggle-container">
          <label class="toggle guest-mode-toggle">
            <input type="checkbox" id="guestModeEnabled">
            <span class="slider"></span>
          </label>
          <span class="toggle-label">Guest Mode</span>
        </div>
        <div class="toggle-container">
          <label class="toggle">
            <input type="checkbox" id="autoFillEnabled" checked>
            <span class="slider"></span>
          </label>
          <span class="toggle-label">Auto-fill</span>
        </div>
      </div>
    </header>

    <!-- Guest Mode Banner -->
    <div id="guestModeBanner" class="guest-mode-banner hidden">
      <span>ğŸ•µï¸ Guest Mode Active - Data stays private</span>
    </div>

    <nav class="tabs">
      <button class="tab active" data-tab="learned">ğŸ“š Learned</button>
      <button class="tab" data-tab="add-new">â• Add New</button>
      <button class="tab" data-tab="templates">ğŸ“‹ Templates</button>
      <button class="tab" data-tab="smart-import">âœ¨ Import</button>
      <button class="tab" data-tab="tools">ğŸ› ï¸ Tools</button>
      <button class="tab" data-tab="settings">âš™ï¸ Settings</button>

    </nav>

    <!-- Site Control -->
    <div class="site-control">
      <span>ğŸŒ Site:</span>
      <span id="currentDomain" class="domain-name">Loading...</span>
      <div class="toggle-container">
        <label class="toggle">
          <input type="checkbox" id="siteEnabled" checked>
          <span class="slider"></span>
        </label>
        <span class="toggle-label">Active</span>
      </div>
    </div>

    <!-- Profile Selector -->
    <div class="profile-bar">
      <label for="profileSelect">Profile:</label>
      <div class="profile-actions">
          <select id="profileSelect" class="profile-select">
            <option value="personal">Personal</option>
            <option value="work">Work</option>
            <option value="job_apps">Job Apps</option>
          </select>
          <button id="addProfileBtn" class="add-profile-btn" title="Add New Profile">+</button>
          <button id="lockProfileBtn" class="lock-profile-btn" title="Lock/Unlock Profile">ğŸ”“</button>
          <button id="shareProfileBtn" class="share-profile-btn" title="Share current profile">ğŸ”—</button>

        </div>
    </div>

    <main class="content">
      <!-- Learned Fields Tab (Dynamic) -->
      <section id="learned" class="tab-content active">
        <div class="search-sort-row">
          <div class="search-box">
            <input type="text" id="searchFields" placeholder="ğŸ” Search fields...">
          </div>
        </div>
        
        <!-- Bulk Actions Bar (Hidden by default) -->
        <div id="bulkActionsBar" class="bulk-actions-bar hidden">
          <div class="bulk-info">
            <input type="checkbox" id="selectAllFields">
            <span id="selectedCount">0 selected</span>
          </div>
          <div class="bulk-buttons">
            <button id="bulkDelete" class="bulk-btn delete" title="Delete selected">ğŸ—‘ï¸</button>
            <button id="bulkMove" class="bulk-btn move" title="Move to category">ğŸ“</button>
          </div>
        </div>

        <div id="learnedFieldsContainer" class="fields-container">
          <!-- Dynamic fields will be rendered here -->
          <p class="empty-state">No fields learned yet. Fill out forms to learn data, or add manually.</p>
        </div>
      </section>

      <!-- Add New Field Tab -->
      <section id="add-new" class="tab-content">
        <div class="form-group">
          <label for="newFieldName">Field Name</label>
          <input type="text" id="newFieldName" placeholder="e.g., university, degree, gpa">
        </div>
        <div class="form-group">
          <label for="newFieldValue">Value</label>
          <input type="text" id="newFieldValue" placeholder="e.g., MIT, Computer Science, 3.8">
        </div>
        <div class="form-group">
          <label for="newFieldCategory">Category</label>
          <select id="newFieldCategory">
            <option value="personal">Personal</option>
            <option value="contact">Contact</option>
            <option value="address">Address</option>
            <option value="professional">Professional</option>
            <option value="education">Education</option>
            <option value="other">Other</option>
          </select>
        </div>
        <button id="addFieldBtn" class="btn btn-primary">Add Field</button>
      </section>

      <!-- Templates Tab -->
      <section id="templates" class="tab-content">
        <p class="section-desc">Import pre-built templates to quickly fill common forms</p>
        <div class="templates-grid">
          <div class="template-card" data-template="linkedin">
            <span class="template-icon">ğŸ’¼</span>
            <span class="template-name">LinkedIn</span>
          </div>
          <div class="template-card" data-template="indeed">
            <span class="template-icon">ğŸ”</span>
            <span class="template-name">Indeed</span>
          </div>
          <div class="template-card" data-template="github">
            <span class="template-icon">ğŸ™</span>
            <span class="template-name">GitHub</span>
          </div>
          <div class="template-card" data-template="workday">
            <span class="template-icon">ğŸ“‹</span>
            <span class="template-name">Workday</span>
          </div>
          <div class="template-card" data-template="contact">
            <span class="template-icon">ğŸ“§</span>
            <span class="template-name">Contact Form</span>
          </div>
          <div class="template-card" data-template="job_application">
            <span class="template-icon">ğŸ“</span>
            <span class="template-name">Job Application</span>
          </div>
        </div>
      </section>

      <!-- Smart Import Tab -->
      <section id="smart-import" class="tab-content">
        <p class="section-desc">Extract data from Resumes, ID Cards, or LinkedIn Profiles</p>
        
        <div class="import-source">
          <div id="dropZone" class="drop-zone">
            <span class="drop-icon">ğŸ“„</span>
            <p>Drop Resume (PDF) or ID Card (Image/PDF)</p>
            <input type="file" id="fileInput" hidden accept=".pdf,.jpg,.jpeg,.png,.docx">
            <button class="btn btn-secondary btn-small">Browse Files</button>
          </div>
          
          <div class="divider">OR</div>
          
          <div class="form-group">
            <label for="linkedinUrl">LinkedIn Profile Link</label>
            <div class="input-with-btn">
              <input type="text" id="linkedinUrl" placeholder="https://www.linkedin.com/in/username">
              <button id="extractUrlBtn" class="btn btn-primary btn-small">Extract</button>
            </div>
          </div>
        </div>

        <!-- Extraction Progress (Hidden) -->
        <div id="extractionProgress" class="extraction-status hidden">
          <div class="loading-spinner"></div>
          <span>Gemini is analyzing...</span>
        </div>

        <!-- Review Extracted Data (Hidden) -->
        <div id="reviewContainer" class="review-container hidden">
          <h4>Review Extracted Data</h4>
          <div id="extractedDataList" class="extracted-data-list"></div>
          <div class="review-actions">
            <button id="saveExtractedBtn" class="btn btn-primary">Save to Profile</button>
            <button id="cancelExtractedBtn" class="btn btn-secondary">Discard</button>
          </div>
        </div>
      </section>

      <!-- AI Tools Tab -->
      <section id="tools" class="tab-content">
        <p class="section-desc">AI-powered tools to supercharge your productivity</p>
        
        <div class="template-card expanded" style="cursor: default;">
          <h4 style="margin-top: 0; display: flex; align-items: center; gap: 8px;">
            <span>âœï¸</span> Cover Letter Generator
          </h4>
          
          <div class="form-group">
            <label for="jobDescription">Job Description</label>
            <div class="input-with-btn">
              <textarea id="jobDescription" placeholder="Paste job description here..." rows="4" style="width: 100%; resize: vertical;"></textarea>
            </div>
            <button id="autoCaptureJDBtn" class="btn btn-secondary btn-small" style="width: 100%; margin-top: 8px;">ğŸ“„ Capture from Page</button>
          </div>
          
          <div class="form-group">
            <label for="coverLetterTone">Tone</label>
            <select id="coverLetterTone" class="select-full">
              <option value="professional">Professional</option>
              <option value="enthusiastic">Enthusiastic</option>
              <option value="confident">Confident</option>
            </select>
          </div>
          
          <button id="generateCoverLetterBtn" class="btn btn-primary" style="width: 100%;">âœ¨ Generate Cover Letter</button>
          
          <div id="coverLetterResult" class="result-area hidden" style="margin-top: 15px;">
            <textarea id="generatedCoverLetter" rows="8" class="form-control" style="width: 100%; margin-bottom: 8px;"></textarea>
            <button id="copyCoverLetterBtn" class="btn btn-secondary" style="width: 100%;">ğŸ“‹ Copy to Clipboard</button>
          </div>
        </div>
      </section>

      <!-- Settings Tab -->
      <section id="settings" class="tab-content">
        <!-- Theme Toggle -->
        <div class="settings-section">
          <h4>Appearance</h4>
          <div class="theme-toggle-row">
            <span>Theme</span>
            <div class="theme-buttons">
              <button id="themeDark" class="theme-btn active" data-theme="dark">ğŸŒ™ Dark</button>
              <button id="themeLight" class="theme-btn" data-theme="light">â˜€ï¸ Light</button>
            </div>
          </div>
        </div>

        <!-- Sync Status -->
        <div class="settings-section">
          <h4>Cloud Sync</h4>
          <div class="sync-status-row">
            <span id="syncStatusText">ğŸŸ¢ Synced</span>
            <span id="lastSyncTime" class="sync-time"></span>
          </div>
          <div class="sync-queue-info hidden" id="syncQueueInfo">
            <span>ğŸ“¤ <span id="queueCount">0</span> changes pending</span>
          </div>

        </div>

        <!-- API Key -->
        <div class="settings-section">
          <h4>Gemini AI</h4>
          <div class="form-group">
            <input type="password" id="geminiApiKey" placeholder="Enter your Gemini API key">
            <div class="api-key-actions">
              <button id="testApiKey" class="btn btn-secondary btn-small">ğŸ› ï¸ Test Connection</button>
              <span id="apiKeyStatus" class="api-status"></span>
            </div>
            <small>Used for smart field matching. <a href="https://aistudio.google.com/app/apikey" target="_blank">Get key</a></small>
          </div>
        </div>

        <div class="settings-section">
          <h4>Backup & Restore</h4>
          <div class="backup-actions">
            <button id="exportDataBtn" class="btn btn-secondary">ğŸ’¾ Export Data</button>
            <button id="importDataBtn" class="btn btn-secondary">ğŸ“‚ Import Data</button>
            <input type="file" id="importFileInput" hidden accept=".json">
          </div>
        </div>

        <!-- Preferences -->
        <div class="settings-section">
          <h4>Preferences</h4>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="showConfirmation" checked>
              Show confirmation before filling
            </label>
          </div>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="learnFromForms" checked>
              Learn from forms I fill
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="showMagicIcon" checked>
              Show Magic Fill Icon
            </label>
          </div>
          <div class="form-group" style="margin-top: 8px;">
            <label for="magicIconBehavior" style="font-size: 12px;">Icon Behavior</label>
            <select id="magicIconBehavior" class="select-small">
              <option value="always">Always Visible</option>
              <option value="hover">On Hover Only</option>
              <option value="focus">Focus Only</option>
            </select>
          </div>
        </div>

        <!-- Data Management -->
        <div class="settings-section">
          <h4>Data</h4>
          <div class="actions">
            <button id="exportData" class="btn btn-secondary">ğŸ“¤ Export</button>
            <button id="importData" class="btn btn-secondary">ğŸ“¥ Import</button>
            <button id="clearData" class="btn btn-danger">ğŸ—‘ï¸ Clear</button>
          </div>
        </div>
        <input type="file" id="importFile" accept=".json" class="hidden">


        <!-- Onboarding -->
        <div class="settings-section">
          <button id="showOnboarding" class="btn btn-secondary full-width">ğŸ“– Show Tutorial</button>
        </div>
      </section>
    </main>

    <footer>
      <p class="status" id="status"></p>
      <p class="field-count" id="fieldCount">0 fields stored</p>
    </footer>
  </div>

  <!-- Onboarding Modal -->
  <div id="onboardingModal" class="onboarding-modal hidden">
    <div class="onboarding-content">
      <div class="onboarding-slide active" data-slide="1">
        <div class="onboarding-icon">ğŸ‘‹</div>
        <h2>Welcome to Smart Form Filler!</h2>
        <p>Automatically fill forms with your saved information.</p>
      </div>
      <div class="onboarding-slide" data-slide="2">
        <div class="onboarding-icon">ğŸ“š</div>
        <h2>Learn from Forms</h2>
        <p>As you fill forms, we'll learn and save your data automatically.</p>
      </div>
      <div class="onboarding-slide" data-slide="3">
        <div class="onboarding-icon">ğŸ‘¤</div>
        <h2>Multiple Profiles</h2>
        <p>Switch between Personal, Work, and Job Apps profiles.</p>
      </div>
      <div class="onboarding-slide" data-slide="4">
        <div class="onboarding-icon">âŒ¨ï¸</div>
        <h2>Keyboard Shortcuts</h2>
        <p><strong>Alt+F</strong> to fill forms<br><strong>Alt+Shift+F</strong> to open popup</p>
      </div>
      <div class="onboarding-nav">
        <div class="onboarding-dots">
          <span class="dot active" data-slide="1"></span>
          <span class="dot" data-slide="2"></span>
          <span class="dot" data-slide="3"></span>
          <span class="dot" data-slide="4"></span>
        </div>
        <button id="onboardingNext" class="btn btn-primary">Next â†’</button>
      </div>
    </div>
  </div>

  <script src="sync-service.js"></script>
  <script src="popup.js"></script>
</body>
</html>
